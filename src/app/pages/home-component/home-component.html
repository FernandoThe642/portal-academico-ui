<div class="home-container">
  <h1>Recursos Multimedia</h1>

  <div *ngIf="isLoading" class="status-message loading">Cargando recursos...</div>
  <div *ngIf="errorMessage" class="status-message error">{{ errorMessage }}</div>

  <div *ngIf="!isLoading && !errorMessage && resources.length === 0" class="status-message info">
    No hay recursos multimedia cargados.
  </div>

  <div *ngIf="!isLoading && !errorMessage && resources.length > 0" class="cards">
    <div *ngFor="let r of resources" class="card-wrap">

      <!-- TARJETA -->
      <div class="card">
        <div class="left">
          <div class="icon">{{ getFileIcon(r.mime_type) }}</div>

          <!-- Miniatura Imágenes -->
          <img *ngIf="r.mime_type.startsWith('image/')"
               [src]="apiService.getResourceViewUrl(r.id)"
               class="thumb-img"
               alt="thumbnail" />

          <!-- Miniatura VIDEO -->
          <video *ngIf="r.mime_type.startsWith('video/')"
                [attr.src]="apiService.getResourceViewUrl(r.id)"
                class="thumb-video"
                preload="metadata"
                muted
                playsinline>
          </video>

          <!-- Miniatura PDF -->
          <iframe *ngIf="r.mime_type === 'application/pdf'"
                  [src]="getSafePdfUrl(r.id)"
                  class="thumb-pdf">
          </iframe>



          <div class="main">
            <div class="title">{{ r.original_name }}</div>
            <div class="sub">{{ r.mime_type }}</div>

            <div class="meta">
              <span class="pill">{{ r.category_name || 'Sin categoría' }}</span>
              <span class="dot">•</span>
              <span>{{ formatSize(r.size_bytes) }}</span>
              <span class="dot">•</span>
              <span>{{ r.created_at | date:'medium' }}</span>
            </div>
          </div>
        </div>

        <div class="right">
          <button class="btn" (click)="togglePreview(r)">
            {{ r.showPreview ? 'Ocultar' : 'Ver' }}
          </button>

          <a class="btn btn-secondary"
             [href]="apiService.getResourceDownloadUrl(r.id)">
            Descargar
          </a>
        </div>
      </div>

      <!-- PREVIEW GRANDE (aparece al dar clic en Ver) -->
      <div class="preview" *ngIf="r.showPreview">

        <!-- Imagen grande -->
        <img *ngIf="r.mime_type.startsWith('image/')"
             [src]="apiService.getResourceViewUrl(r.id)"
             class="preview-img"
             alt="preview" />
          <!-- Video -->
          <video *ngIf="r.mime_type.startsWith('video/')"
                [src]="apiService.getResourceViewUrl(r.id)"
                class="preview-video"
                controls
                preload="metadata">
          </video>

        <!-- PDF -->
        <iframe *ngIf="r.mime_type === 'application/pdf'"
                [src]="getSafePdfUrl(r.id)"
                class="preview-pdf">
        </iframe>


        <!-- No soportado -->
        <div *ngIf="!r.mime_type.startsWith('image/') && r.mime_type !== 'application/pdf'"
             class="no-preview">
          Este archivo no admite previsualización.
        </div>
      </div>

    </div>
  </div>
</div>
